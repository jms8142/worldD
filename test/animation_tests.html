<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>World Denomination</title>
<link rel="stylesheet" href="/css/styles.css" type="text/css"/>
<script type='text/javascript' src='http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js'></script>
<script type='text/javascript' src='/js/lib/prototype.js'></script>
<script type='text/javascript' src='/js/DrawableElement.js'></script>
<script type='text/javascript' src='/js/GameTile.js'></script>

<script>

var x = 0;

var tileMap =  new Array();
var _canvas = null;
var _canvasContext = null;
var _canvasBufferContext = null;
var _gameTile = null;
var mask = {};
var _timer;
var testSettings = {
	blockHeight : 100,
	blockWidth : 100,
	maskFill : 'rgb(255,255,255)',
	maskStrokeWidth : 1,
	animationSpeed : 10
}

var grabX = 0;
var grabY = 0;
var grabWidth =  0;
var grabHeight = 0;
var testplacementX = 0;
var testplacementY = 0;
var imgd = null;
var NewSectionSlice = 2;


jQuery(function(){
	/*
	jQuery('#btn_start').click(function(e){
		e.preventDefault();
		setInterval(loop,100);
	});
	
	function loop(){
		console.info('[' + x + '] loop' )
			x++;
	}
	*/


	_canvas = document.getElementById('canvas');
	_canvasContext = _canvas.getContext('2d');
	_canvasBuffer = document.createElement('canvas');
	_canvasBuffer.width = _canvas.width;
	_canvasBuffer.height = _canvas.height;
	_canvasBufferContext = _canvasBuffer.getContext('2d');

	//create tile
	_gameTile = new GameTile({ x : 50, y : 50, mapX : 0, mapY : 0 });
	_gameTile.setHeight(testSettings.blockHeight);
	_gameTile.setWidth(testSettings.blockWidth);
	_gameTile.setValue(1);
	_gameTile.setText(5);

	_gameTile.render(_canvasBufferContext);
	_canvasContext.drawImage(_canvasBuffer, 0, 0);


	jQuery('#btn_moveup').click(function(e){
		e.preventDefault();
		/*
		mask.x = _gameTile.getCanvasLocation().x - 1;
		mask.y = _gameTile.getCanvasLocation().y + _gameTile.getHeight();
		mask.fillColor = testSettings.maskFill;
		mask.width = _gameTile.getWidth() + 2;
		mask.endHeight = _gameTile.getHeight() + 2;
		mask.startHeight = 1;
		console.info(mask);
		*/
		copyImage();
		
		_timer = setInterval(loop,testSettings.animationSpeed);

	});


});


function loop(){
	
	_draw();
	//console.info(NewSectionSlice);
	
	NewSectionSlice += 2;
	
	if(NewSectionSlice > _gameTile.getHeight()) {
		window.clearInterval(_timer);
		clearArea();
	}
}

function copyImage(){	
	grabX = _gameTile.getCanvasLocation().x-1;
	grabY = _gameTile.getCanvasLocation().y-1;
	grabWidth =  _gameTile.getWidth()+2;
	grabHeight = _gameTile.getHeight()+2;
	testplacementX = _gameTile.getCanvasLocation().x + (_gameTile.getWidth()+10);
	testplacementY = _gameTile.getCanvasLocation().y-1;

	imgd = _canvasBufferContext.getImageData(grabX, grabY, grabWidth, grabHeight);

	_canvasBufferContext.putImageData(imgd,testplacementX,testplacementY);

	_canvasContext.drawImage(_canvasBuffer,0,0);
	
	//now run through some kind of transition effect loop


}

function _draw(){
	console.info(NewSectionSlice);
	//mask the area first
	clearArea()

	//draw pieces
	//var imageSlice = _canvasBufferContext.getImageData(imgd);
	//var imageSlice = _canvasBufferContext.getImageData(grabX,grabY + NewSectionSlice,grabWidth,grabHeight - NewSectionSlice);

	_canvasBufferContext.putImageData(imageSlice,testplacementX,testplacementY);

	_canvasContext.drawImage(_canvasBuffer,0,0);
	
}

function clearArea(){
	_canvasBufferContext.fillStyle = testSettings.maskFill;
	_canvasBufferContext.fillRect(testplacementX,testplacementY,grabWidth,grabHeight);
	_canvasContext.drawImage(_canvasBuffer,0,0);
}


</script>

</head>

<body>
Animation Tests<br/>
<canvas id="canvas" width="300" height="300">
Canvas not supported.
</canvas><br/><br/>
<br/>
<input type="button" value="Move Up" id="btn_moveup"/>
<input type="button" value="Move Down" id="btn_movedown"/>
<input type="button" value="Move Left" id="btn_moveleft"/>
<input type="button" value="Move Right" id="btn_moveright"/>

</body>
</html>
